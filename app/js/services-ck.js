App.factory("GuideModel",function(e,t,n,r){return{getGuides:function(){return t.get("/app/api")},getGuide:function(e){return t.get("/app/api",{params:{slug:e}})},addGuide:function(e){return t.get("/app/api/add-guide.php",{params:e})},deleteGuide:function(e){return t.get("/app/api/delete-guide.php",{params:{id:e}})},saveGuide:function(e){e.id||(e.id=e._id.$id);return t.get("/app/api/save-guide.php",{params:{json:angular.toJson(e)}})},addBook:function(e){n.guide.books||(n.guide.books=[]);n.guide.books.push(e)},deleteBook:function(e){n.guide.books.splice(e,1)},addChapter:function(e){n.guide.books[r.bookSlug].chapters||(n.guide.books[r.bookSlug].chapters=[]);n.guide.books[r.bookSlug].chapters.push(e)},deleteChapter:function(e){n.guide.books[r.bookSlug].chapters.splice(e,1)},addPageRef:function(e){n.guide.books[r.bookSlug].chapters[r.chapterSlug].pages||(n.guide.books[r.bookSlug].chapters[r.chapterSlug].pages=[]);n.guide.books[r.bookSlug].chapters[r.chapterSlug].pages.push(e)},deletePageRef:function(e){n.guide.books[r.bookSlug].chapters[r.chapterSlug].pages.splice(e,1)}}});App.factory("PageModel",function(e,t){return{getPage:function(e){return t.get("/app/api/get-page.php",{params:e})},createNewPage:function(e){return t.get("/app/api/add-page.php",{params:e})},deletePage:function(e){return t.get("/app/api/delete-page.php",{params:e})},getContent:function(){return t.get("/app/api/get-content.php")},savePage:function(e){e.id||(e.id=e._id.$id);return t.get("/app/api/save-page.php",{params:{json:angular.toJson(e)}})}}});App.factory("UtilFactory",function(e,t,n,r,i,s,o){return{makeMarkdown:function(e){var t=new Showdown.converter;if(e)return t.makeHtml(e)},getPageFromId:function(e,t){var n={ref:t,id:e};return s.getPage(n)},currentPlace:function(){return n.guide.books[r.bookSlug]},addBookDialog:function(){function t(e,t){e.addBook=function(){o.addBook(e.form);o.saveGuide(n.guide)}}var e='<div class="modal-header"><h3>Add a book</h3></div><div class="modal-body"><form><input class="input" ng-model="form.title" /></div><div class="modal-footer"><button ng-click="addBook(title)" class="btn btn-primary" >Add</button> <button ng-click="close(title)" class="btn btn-primary" >Close</button></form></div>',r={backdrop:!0,keyboard:!0,backdropClick:!0,template:e,controller:t},s=i.dialog(r);s.open().then(function(e){e&&alert("dialog closed with result: "+e)})},addChapterDialog:function(e){function s(e,t){e.addItem=function(){o.addChapter(e.form);o.saveGuide(n.guide)}}var t='<div class="modal-header"><h3>Add a Chapter</h3></div><div class="modal-body"><form><input class="input" ng-model="form.title" /></div><div class="modal-footer"><button ng-click="addItem()" class="btn btn-primary" >Add</button> <button ng-click="close(title)" class="btn btn-primary" >Close</button></form></div>';r.bookSlug=e;var u={backdrop:!0,keyboard:!0,backdropClick:!0,template:t,controller:s},a=i.dialog(u);a.open().then(function(e){e&&alert("dialog closed with result: "+e)})}}});App.factory("sharedServices",function(e,t){var n={};n.copiedItem={};n.copyChapter=function(t){this.copiedItem=t;e.$broadcast("copiedChapter")};n.copyBook=function(t){this.copiedItem=t;e.$broadcast("copiedBook")};n.broadcastItem=function(){e.$broadcast("copiedChapter")};n.getBooks=function(){return e.guide.books};n.addBook=function(t){e.guide.books||(e.guide.books=[]);e.guide.books.push(t)};n.guide={};n.currentGuide=function(t){this.guide=t;e.$broadcast("guideReady")};return n});